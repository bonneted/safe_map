<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Map Application</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
<div id="helpModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2>How to Use This Tool</h2>
    <ul>
      <li><strong>Plotting a Route:</strong> Click on the map twice to set the starting and ending points for your route.</li>
      <li><strong>Choose Data Type:</strong> Choose between "collected" accident data or "predicted" risk based on road properties.</li>
      <li><strong>Adjust Risk Coefficient:</strong> Use the slider to weigh the safety importance in the route calculation.</li>
      <li><strong>Keep Routes Alive:</strong> Enable this option to display multiple routes simultaneously.</li>
      <li><strong>Show Data:</strong> Plot accidents coordinates and/or roads risk scores on the map.</li>
    </ul>
    <div class="more-info">
      <h3>More Information</h3>
      <p>This routing algorithm was made during an hackathon organised inside the Greydient ITN project, for more information please visit the <a href="https://www.greydient.eu/">Greydient website</a>.</p>
      <p>The goal was to use a database of recorded accidents to take into account the safety in the routing algorithm. 
        They first step was to project the accident data onto the road network (from OpenStreetMap) using nearest neighbor search. It was then possible to calculate the number of accidents ecountered for each route and use it as a cost function ("collected data").
        Secondly, we established statistical correlations between road properties (from OpenStreetMap: road type, speed limit, number of lanes, etc.) and the number of accidents. We used these statistics to assign a risk score to each road segment, building a cost function more robust to non-representative data ("predicted data"). 
        This robustness can be shown by switching between data type : large detours appearing with collected data disappear when switching to predicted.
      </p>
      <p><strong>Note:</strong> To be truly relevant, the accident data should be weighted by the traffic volume. This is not the case here, but it could be added in the future.</p>

    </div>

  </div>
</div>

<div class="control-panel">
    <button id="homeBtn">Home</button>

    <div class="control-group">
        <label for="dataTypeSelect">data type:</label>
        <select id="dataTypeSelect">
            <option value="num_accidents">collected</option>
            <option value="predicted_accidents">predicted</option>
        </select>
    </div>
    
    <div class="range-group">
        <span>shortest</span>
        <input type="range" id="alphaSlider" min="0" max="1" step="0.01" value="1">
        <span>safest</span>
    </div>
    
    <div class="control-group">
        <input type="checkbox" id="keepLinesAlive" name="keepLinesAlive">
        <label for="keepLinesAlive">keep routes alive</label>
        <input type="checkbox" id="showAccidentData" name="showAccidentData">
        <label for="keepLinesAlive">show data</label>
    </div>
    <button id="helpBtn">?</button>
</div>
<div id="mapid">
  <div id="loader" style="display: none;">
    <div class="loader">
      <span class="inner1"></span>
      <span class="inner2"></span>
      <span class="inner3"></span>
    </div>

</div>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script src="{{ url_for('static', filename='js/map.js') }}"></script>
</body>
</html>
